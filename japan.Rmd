---
title: 50-State Redistricting Simulations
description: |
  Comprehensive project to simulate alternative redistricting plans for all Japan.
date: february 4, 2022
output:
  distill::distill_article:
    self_contained: false
repository_url: https://github.com/alarm-redist/japan/
doi: "10.7910/DVN/SLCD3E"
citation: true
---

```{r setup, include=F}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, error=TRUE)
library(here)
library(tidyverse)
library(ggiraph)
library(sf)
```

```{css echo=FALSE}
div.girafe { margin-bottom: 0; }
.girafe_container_std svg text { pointer-events: none; }
.state-links { column-count: 3; }
@media only screen and (max-width: 600px) {
    .state-links { column-count: 2; }
}
```

[An intro blurb about the project]

[More information about the project]. 
Click on a state to learn more.

```{r include=F}
prefs = Sys.glob(here("analyses/*_*")) |>
    basename() |>
    substr(1, 2) |>
    as.integer()
```

```{r map, layout="l-body-outset", cache=TRUE, cache.extra=prefs}
d_appor = read_csv(here("pref_code.csv"))

japan = readRDS(here("carto_japan.rds")) %>%
    st_set_crs(NA) %>%
    rename(pref_code = ken) %>%
    mutate(pref_japanese = d_appor$pref_japanese) %>%
    left_join(d_appor, by="pref_japanese") %>%
    dplyr::select(-code) %>%
    mutate(factor = sqrt(d_appor$n_dist_new/d_appor$n_dist_old) * 4/5 ,
           centroid = st_centroid(geometry),
           geometry = (geometry - centroid)*factor + centroid) %>%
    mutate(available = pref_code %in% prefs,
           fill_code = case_when(n_dist_new == 1 ~ "ready",
                                 available ~ "ready",
                                 TRUE ~ "not_ready"),
           href = if_else(available, str_glue("analyses/{str_pad(pref_code, 2, pad = '0')}_{tolower(pref_english)}/"), "#"),
           code = if_else(available, str_glue('window.open("{href}web_{str_pad(pref_code, 2, pad = "0")}_{tolower(pref_english)}.html", "_self")'), ""),
           tooltip = str_glue("<b>{pref_japanese}</b><br />区割り改定前：{n_dist_old}席<br />区割り改定後：{n_dist_new}席"))

p = ggplot(japan, aes(fill=fill_code, data_id=pref_japanese)) +
    geom_sf_interactive(aes(onclick=code, tooltip=tooltip), color=NA, size=0.0) +
    scale_fill_manual(values=c(ready="#925637", not_ready="#333333"), 
                      guide="none") +
    theme_void() +
    theme(plot.margin = margin(0, 0, 0, 0, "cm"))
girafe(ggobj=p, width_svg=9, height_svg=6, options=list(
    opts_hover(css="cursor: pointer;
                    filter: drop-shadow(2px 2px 3px #0004)"),
    opts_tooltip(css="font-family: 'Arial'; 
                 background: #fffa; 
                 border-radius: 3px; 
                 padding: 0.3em;
                 backdrop-filter: blur(6px);",
                 delay_mouseover=100,
                 delay_mouseout=100),
    opts_toolbar(saveaspng=FALSE)
    ))
```

### Analyzed States 

```{r links, results='asis'}
cat('<div class="state-links">')
filter(japan, available) %>%
    arrange(pref_japanese) %>%
    mutate(html = str_glue('<p><a href="{href}web_{str_pad(pref_code, 2, pad = "0")}_{tolower(pref_english)}.html">{pref_japanese}</a></p>')) %>%
    pull() %>%
    cat(collapse="\n")
cat('</div><br />\n\n')
```

<center>

**Download the data: *[ALARM Project Dataverse](https://doi.org/10.7910/DVN/SLCD3E)* &raquo;**

</center>

## Data Sources and Availability {.appendix}

Unless otherwise noted, data for each state comes from the ALARM Project's
[2020 Redistricting Data Files](https://alarm-redist.github.io/posts/2021-08-10-census-2020/),
which use U.S. Census demographic data (in the public domain) and election data 
from the [Voting and Election Science Team](https://dataverse.harvard.edu/dataverse/electionscience), 
which is licensed  under a [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/) license.
In these cases, shapefiles are also taken from the U.S. Census Bureau.
The U.S. map here, scaled to reflect Congressional representations, is courtesy of <https://dkel.ec/map>.

All data is available [on our  Dataverse](https://doi.org/10.7910/DVN/SLCD3E).
Code is available [on GitHub](https://github.com/alarm-redist/fifty-states/).

